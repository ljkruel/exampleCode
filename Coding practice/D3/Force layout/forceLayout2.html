<html>
<head>
	<title>Force layout test 2</title>
	<link rel="stylesheet" type="text/css" href="forceLayout.css"/>
</head>
<body>
	<h1>A Force Layout chart - preventing nodes overlapping (fail)</h1>
	<p>An example of messing with the charge property per node so that their is less white space and nodes do not overlap.
		Not altogether successful as some nodes still overlap but there is less white space present.
	</p>
	<p>Each node has it's own charge calculated based on the size property to try to limit oculsion.</p>
	<p>Main issue is manual tuning required.</p>
	<p>In this example the node radius is "size" and the colour is "category1"</p>
	
	<div id="chartArea"></div>
	
	<p>Check out the source. Code of interest below:
	<pre class="prettyprint">
forceLayouter.charge(specialCharge);

function specialCharge(d) {
    return -(d.size*2);
}
	</pre>
	<p>Function specialCharge is called for each node and returns a negative value proportional to the size property of the node. 
		Note mulitplied by two - this is trial and error...
	</p>
	
	<script src="https://google-code-prettify.googlecode.com/svn/loader/run_prettify.js"></script>
	<script src="../dist/d3.js" charset="utf-8"></script>
	<script>
		
		// Create a load of random data objects.
		var numDataPts = 100;
		var numCategory1s = 4;
		var numCategory2s = 6;
		
		var activeCategory = "category1";
		
		var data = [];
		for(var i = 0; i < numDataPts; i++) {
			data.push({ size: Math.random() * 20, category1: Math.floor(Math.random() * 4), category2:Math.floor(Math.random() * 4) });
		}
		
		
		var width = 400, height = 400;
		
		// create the container for the force layout chart
		var chart = d3.select("#chartArea").append("svg").attr("width", width).attr("height",height);
		
		// this scale is used to colour nodes by category.
		var colourRamp = d3.scale.category10();
		
		
		// create a force layouter 
		var forceLayouter = d3.layout.force().size([width, height]).nodes(data).on("tick", forceTick);
		
		forceLayouter.charge(specialCharge);
	
		// draw the nodes
		nodes = chart.selectAll(".nodes").data(data)
							.enter()
								.append("circle")
									.attr("class", "nodes")
									.attr("cx", function(d) { return d.x; })
									.attr("cy", function(d) { return d.y; })
									.attr("r", function(d) { return d.size ; })
									.style("stroke", function(d) { return colourRamp(d[activeCategory])})
									.style("fill", function(d) { return colourRamp(d[activeCategory])});
									
									
		forceLayouter.start();
		
		
		// std d3 tick function copy and pasted from d3js.org
		function forceTick(ev) {
			 nodes.attr("cx", function(d) { return d.x; }).attr("cy", function(d) { return d.y; });
		}
		
		function specialCharge(d) {
			return -(d.size*2);
		}
	
	</script>
</body>	
</html>