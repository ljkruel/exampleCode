<html>
<head>
	<title>Force layout test 2</title>
	<link rel="stylesheet" type="text/css" href="forceLayout.css"/>
</head>
<body>
	<h1>A Force Layout chart with nodes separated by type</h1>
	<p>In this graph chart, the nodes are forced to separate into layers by category (category shown by colour).</p>
	
	
	<div id="chartArea"></div>
	
	<p>Check out the source. Main code below.
	<pre class="prettyprint">
function forceTick(ev) {
	var alpha = ev.alpha;
	nodes.each(function(d) {
		d.y += alpha * alpha  * 100 * d[activeCategory];
	});
	nodes.attr("cx", function(d) { return d.x; }).attr("cy", function(d) { return d.y; });
}
	</pre>
	<p>Before updating the position of each node, the forceTick function iterates over each node, adding
	a y-axis offset proportional to the index of the category. This forces the nodes of difference categories apart.
	</p>
	<p>
		Alpha property reduces to zero as the force layout stabalises. Hence, as the layout starts, the category has a greater 
		affect on the layout, but reduces as time goes by. However, the nodes are now layered. 
	</p>
	<ul>
		<li>alpha squared to reduce effect of layering as the layout stablises verses the std forces.</li>
	</ul>
	<script src="https://google-code-prettify.googlecode.com/svn/loader/run_prettify.js"></script>
	<script src="../dist/d3.js" charset="utf-8"></script>
	<script>
		
		// Create a load of random data objects.
		var numDataPts = 100;
		var numCategory1s = 10;
		var numCategory2s = 6;
		
		var activeCategory = "category1";
		
		var data = [];
		for(var i = 0; i < numDataPts; i++) {
			data.push({ size: Math.random() * 20, category1: Math.floor(Math.random() * numCategory1s), category2:Math.floor(Math.random() * numCategory2s) });
		}
		
		
		var width = 400, height = 400;
		
		// create the container for the force layout chart
		var chart = d3.select("#chartArea").append("svg").attr("width", width).attr("height",height);
		
		// this scale is used to colour nodes by category.
		var colourRamp = d3.scale.category10();
		
		// create a force layouter 
		var forceLayouter = d3.layout.force().size([width, height]).nodes(data).on("tick", forceTick);
		
		
		// draw the nodes
		nodes = chart.selectAll(".nodes").data(data)
							.enter()
								.append("circle")
									.attr("class", "nodes")
									.attr("cx", function(d) { return d.x; })
									.attr("cy", function(d) { return d.y; })
									.attr("r", function(d) { return d.size; })
									.style("stroke", function(d) { return colourRamp(d[activeCategory])})
									.style("fill", function(d) { return colourRamp(d[activeCategory])});
									
		// start the force layout update							
		forceLayouter.start();
		
		
		// tick function called when the graph needs updating
		function forceTick(ev) {
		
			var alpha = ev.alpha;
			
			nodes.each(function(d) {
				
				d.y += alpha * alpha *  50 * (d[activeCategory] - 4);
				
			});
		
			nodes.attr("cx", function(d) { return d.x; }).attr("cy", function(d) { return d.y; });
		}
		
		
	
	</script>
</body>	
</html>