<html>
<head>
	<title>Force layout test 1 with tooltips</title>
	<link rel="stylesheet" type="text/css" href="forceLayout.css"/>
	<style>
		.tooltip {
			border: 1px solid black;
			background: white; 
			position: absolute; 
			z-index: 999;
			width: 300px;
			content: "";
			border-radius: 5px;
			padding: 5px; 	
			visibility: collapse; 
		}
		
	</style> 
</head>
<body>
	
	
	
	<h1>A Basic Force Layout chart with tooltips</h1>
	<p>Example of the simplest force layout chart. One hundred nodes with random values. Each node is a visualisation of an object shown below:</p>
	<p>Tooltips on hover</p>
	<pre class="prettyprint">
{
   size: 17.283,
   category1: 2,
   category2: 6
}
</pre>
	<p>In this example the node radius is "size" and the colour is "category1"</p>
		
	<div id="chartArea">
		<div class="tooltip" id="chartTooltip"></div>
	</div>
	
	
	
	<form>
		<h4>Control the force layout</h4>
		<p><label>Number of nodes: <input type="number" id="numberOfNodes" /></label></p>
		<button type="button" id="rerunButton">Rerun graph</button>
	</form>
	
	<p>Check out the source. Main code below.
	<pre class="prettyprint">
var forceLayouter = d3.layout.force()
                          .size([width, height])
                          .nodes(data)
                          .on("tick", forceTick);	
	
function forceTick(ev) {
  nodes
    .attr("cx", function(d) { return d.x; })
    .attr("cy", function(d) { return d.y; });
}
	</pre>
	<p>Note; .size property required otherwise centers on [0,0]</p>
	
	<script src="https://google-code-prettify.googlecode.com/svn/loader/run_prettify.js"></script>
	<script src="../dist/d3.js" charset="utf-8"></script>
	<script>
		
				
		// Create a load of random data objects.
		var numDataPts = 100;
		var numCategory1s = 4;
		var numCategory2s = 6;
		var width = 400, height = 400;
		var activeCategory = "category1";
		
		drawChart();
		
		function drawChart() {
			
			// create the data points
			var data = [];
			for(var i = 0; i < numDataPts; i++) {
				data.push({ size: Math.random() * 20, category1: Math.floor(Math.random() * 4), category2:Math.floor(Math.random() * 4) });
			}		
			
			
			
			
			/////////////////////////////////////////////////////////////////////////////
			// FORCE LAYOUT TEST CODE
			/////////////////////////////////////////////////////////////////////////////
		
			
			// create the container for the force layout chart
			var chart = d3.select("#chartArea").append("svg").attr("width", width).attr("height",height);
			
			// this scale is used to colour nodes by category.
			var colourRamp = d3.scale.category10();
			
		
			
			// create a force layouter 
			var forceLayouter = d3.layout.force().size([width, height]).nodes(data).on("tick", forceTick);
			
			
			// draw the nodes
			nodes = chart.selectAll(".nodes").data(data)
								.enter()
									.append("circle")
										.attr("class", "nodes")
										.attr("cx", function(d) { return d.x; })
										.attr("cy", function(d) { return d.y; })
										.attr("r", function(d) { return d.size; })
										.style("stroke", function(d) { return colourRamp(d[activeCategory])})
										.style("fill", function(d) { return colourRamp(d[activeCategory])})
										.on("mouseover", tooltipOn)
										.on("mouseout", tooltipOff);
										
										
			forceLayouter.start();
			
			
			// std d3 tick function copy and pasted from d3js.org
			function forceTick(ev) {
					nodes.attr("cx", function(d) { return d.x; }).attr("cy", function(d) { return d.y; });
			}
		}
		
		function tooltipOn(d) {
			
			var contents = "<p>Size: <span>" + d.size + "</span></p><p>Category one: <span>" + d.category1 + "</span></p><p>Category two: <span>" +  d.category2  + "</span></p>"
			var tooltip = document.querySelector("#chartTooltip");
			
			tooltip.innerHTML = contents;
			tooltip.style.top = (tooltip.parentElement.offsetTop + d.y - d.size - tooltip.clientHeight) + "px";
			tooltip.style.left = (tooltip.parentElement.offsetLeft +  d.x) + "px";
			tooltip.style.visibility = "visible";
		}
		
		function tooltipOff(ev) {
						var tooltip = document.querySelector("#chartTooltip");
			tooltip.style.visibility = "collapse";
		}
		
		/////////////////////////////////////////////////////////////////////////////
		// END FORCE LAYOUT TEST CODE
		/////////////////////////////////////////////////////////////////////////////


		// set up controls to allow graph parameters to be changed
		document.querySelector("#numberOfNodes").value = numDataPts;
		
		document.querySelector("#rerunButton").addEventListener("click", function(ev) {
			
			d3.select("#chartArea svg").remove();
			
			numDataPts = document.querySelector("#numberOfNodes").value;
			
			drawChart();
			//forceLayouter.start();
			
		});
	
	</script>
</body>	
</html>